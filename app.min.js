const API_BASE="https://pcd-eventos.onrender.com";let token=localStorage.getItem("pcd_token")||null,usuarioAtual=null,loginScreen=document.getElementById("login-screen"),app=document.getElementById("app"),loginMsg=document.getElementById("login-msg"),btnLogin=document.getElementById("btn-login"),btnLogout=document.getElementById("btn-logout"),btnTema=document.getElementById("toggle-theme"),navAdmin=document.getElementById("nav-admin");function aplicarTema(){const e=localStorage.getItem("pcd_tema")||"claro";document.documentElement.classList.toggle("dark","escuro"===e),btnTema.textContent="escuro"===e?"â˜€ï¸":"ðŸŒ™"}aplicarTema(),btnTema.addEventListener("click",()=>{const e=!document.documentElement.classList.contains("dark");document.documentElement.classList.toggle("dark",e),localStorage.setItem("pcd_tema",e?"escuro":"claro"),btnTema.textContent=e?"â˜€ï¸":"ðŸŒ™"});async function login(){const e=document.getElementById("login-email").value.trim(),t=document.getElementById("login-pass").value.trim();if(!e||!t)return showMsg("Preencha e-mail e senha.",!0);try{const s=await fetch(`${API_BASE}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,senha:t})}),a=await s.json();if(!s.ok)throw new Error(a.error||"Falha no login");token=a.token,usuarioAtual=a.user,localStorage.setItem("pcd_token",token),loginScreen.classList.add("hidden"),app.classList.remove("hidden"),"admin"===usuarioAtual.role&&navAdmin.classList.remove("hidden"),carregarEventos(),carregarPessoas(),carregarUsuarios(),carregarSelectRelatorio()}catch(e){showMsg(e.message,!0)}}btnLogin.addEventListener("click",login),btnLogout.addEventListener("click",()=>{localStorage.removeItem("pcd_token"),token=null,usuarioAtual=null,app.classList.add("hidden"),loginScreen.classList.remove("hidden")});function showMsg(e,t=!1){loginMsg.style.display="block",loginMsg.style.color=t?"red":"green",loginMsg.textContent=e,setTimeout(()=>loginMsg.style.display="none",3e3)}document.querySelectorAll("button[data-target]").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-target");document.querySelectorAll("#app section.card").forEach(e=>e.classList.add("hidden")),document.getElementById(t).classList.remove("hidden")})});async function api(e,t="GET",s=null){const a={"Authorization":"Bearer "+token};s&&!(s instanceof FormData)&&(a["Content-Type"]="application/json");const n=await fetch(`${API_BASE}${e}`,{method:t,headers:a,body:s instanceof FormData?s:s?JSON.stringify(s):null}),i=await n.json();if(!n.ok)throw new Error(i.error||"Erro na API");return i}const tabelaEventos=document.querySelector("#tabela-eventos tbody"),formEvento=document.getElementById("form-evento"),eventoNome=document.getElementById("evento-nome"),eventoData=document.getElementById("evento-data"),eventoDescricao=document.getElementById("evento-descricao"),btnLimparEvento=document.getElementById("btn-limpar-evento");let eventoEditando=null;async function carregarEventos(){try{co
